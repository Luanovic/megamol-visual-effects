cmake_minimum_required(VERSION 3.8)
project(imguitexinspect CXX)

find_package(imgui CONFIG REQUIRED)
get_target_property(IMGUI_INCLUDE_DIRS imgui::imgui
    INTERFACE_INCLUDE_DIRECTORIES
)

include(GNUInstallDirs)

set_property(CACHE IMGUITEXINSPECT_OPENGL_INCLUDE PROPERTY STRINGS "NONE" "GLAD" "GLAD2" "GL3W" "GLEW" "GLBINDING2" "GLBINDING3" "EPOXY" "CUSTOM" "ES2" "ES3")

set(IMGUITEXINSPECT_HEADERS
  imgui_tex_inspect_internal.h
  imgui_tex_inspect.h
  backends/tex_inspect_opengl.h)
set(IMGUITEXINSPECT_SOURCES
  imgui_tex_inspect.cpp
  backends/tex_inspect_opengl.cpp)

add_library(${PROJECT_NAME} STATIC ${IMGUITEXINSPECT_SOURCES} ${IMGUITEXINSPECT_HEADERS})
set_target_properties(${PROJECT_NAME} PROPERTIES POSITION_INDEPENDENT_CODE ON)
target_compile_definitions(${PROJECT_NAME} PRIVATE IMGUI_IMPL_OPENGL_LOADER_${IMGUITEXINSPECT_OPENGL_INCLUDE})
#target_include_directories(${PROJECT_NAME} PRIVATE ${PROJECT_SOURCE_DIR} ${IMGUI_INCLUDE_DIRS} ${GLAD_INCLUDE_DIR})
target_include_directories(
	${PROJECT_NAME}
	PUBLIC
        #TODO: what are those?
	   	$<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}>
		$<INSTALL_INTERFACE:include>
	PRIVATE
        ${PROJECT_SOURCE_DIR}
		${IMGUI_INCLUDE_DIRS}
        ${GLAD_INCLUDE_DIR}
)
target_link_libraries(${PROJECT_NAME} PRIVATE imgui::imgui)

install(FILES ${IMGUITEXINSPECT_HEADERS} DESTINATION "${CMAKE_INSTALL_INCLUDEDIR}")

install(
	TARGETS ${PROJECT_NAME}
	EXPORT ${PROJECT_NAME}_target
	ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
	LIBRARY DESTINATION ${CMAKE_INSTALL_LIBDIR}
	RUNTIME DESTINATION ${CMAKE_INSTALL_BINDIR}
)

install(
	EXPORT ${PROJECT_NAME}_target
	NAMESPACE ${PROJECT_NAME}::
	FILE ${PROJECT_NAME}-config.cmake
	DESTINATION share/${PROJECT_NAME}
)
